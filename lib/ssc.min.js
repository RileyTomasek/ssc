!function(t){"use strict";"function"==typeof define&&define.amd?define(t):window.ssc=t()}(function(){"use strict";function t(){var r,e,n,i;if(arguments[0]instanceof t)i=arguments[0],this._matrix=i._matrix,this._cache=i._cache;else if(arguments[0]instanceof Array)this._matrix=s.cloneNumArray(arguments[0]),this._cache=arguments[1]||{};else{for(this._matrix=[],r=0;r<arguments[0];r++){for(n=[],e=0;e<arguments[1];e++)n.push(r===e?1:0);this._matrix.push(n)}this._cache=arguments[2]||{}}this.rows=this._matrix.length,this.cols=this._matrix[0].length}function r(r,e,n,a){t.call(this,r),this._origin=e,this._elem=n;var o=n.getAttribute("data-sscid");this._cache=s.cacheMod(i[o]||{},null,a)}function e(t,e){t=s.getElem(t);var n,i,a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],o=s.getPrefixedStyle(t,"transform"),c=s.getPrefixedStyle(t,"transformOrigin");if(i=c.split(" ").map(parseFloat),i[2]=i[2]||0,o&&"none"!==o)if(n=o.substring(o.indexOf("(")+1,o.length-1),n=n.split(", ").map(function(t){return s.truncate(parseFloat(t),2)}),6===n.length)n.map(function(t,r){var e=r%2,n=Math.floor(r/2)+(r>3?1:0);a[e][n]=t});else{if(16!==n.length)throw Error("elem has a transformation matrix that is not well defined");n.map(function(t,r){var e=r%4,n=Math.floor(r/4);a[e][n]=t})}return new r(a,i,t,e)}function n(t,r){return e(t,r)}var i={},a=0,s={getElem:function(t){if(!(t instanceof Element)){if("string"!=typeof t)throw Error("elem must be either an Element or a CSS Selector");if(t=document.querySelector(t),!t)throw Error("elem selector does not refer to a valid Element")}return t},extend:function(t,r){var e,n=Object.create(t);for(e in r)r.hasOwnProperty(e)&&(n[e]=r[e]);return n},merge:function(t,r){var e,n=this.cloneObject(t);for(e in r)r.hasOwnProperty(e)&&(n[e]=r[e]);return n},truncate:function(t,r){var e=Math.pow(10,r);return Math.round(t*e)/e},padVector:function(t,r,e){var n,i=[];for(r=r||3,e=void 0!==e?e:0,n=0;r>n;n++)i.push(t[n]||0===t[n]?t[n]:e);return i},parseVectorArgs:function(t,r,e){t=Array.prototype.slice.call(t);var n=(t[0]instanceof Array?t[0]:t).slice(0,3);return s.padVector(n,r,e)},parseOriginArgs:function(t,r){var e=[];return"string"==typeof t[0]?t[0].split(" ").map(function(t,n,i){var a;if(-1!==t.indexOf("%"))a=0===n?r.width:r.height,e[n]=a*parseFloat(t)/100;else switch(t.toLowerCase()){case"left":e[0]=0;break;case"right":e[0]=r.width;break;case"top":e[1]=0;break;case"bottom":e[1]=r.height;break;case"center":1===i.length?e=[r.width/2,r.height/2]:0===n?e[0]=r.width/2:e[1]=r.height/2;break;default:e[2]=parseInt(t,10)}}):e=s.parseVectorArgs(t,3,null),e[2]=e[2]||0,e},zip:function(){var t=Array.prototype.slice.call(arguments),r=t.reduce(function(t,r){return t.length<r.length?t:r});return r.map(function(r,e){return t.map(function(t){return t[e]})})},normalizeVector:function(t){var r,e;return r=Math.sqrt(t.reduce(function(t,r){return t+Math.pow(r,2)},0)),e=t.map(function(t){return t/r}),r?e:0},hasRotate:function(t){t=t._matrix;var r=[t[0][0],t[1][1],t[2][2]].reduce(function(t,r){return t&&r>=0},!0);return!(!(t[0][1]||t[1][2]||t[2][0])&&r)},VENDORS:["Moz","Webkit","ms","O"],setPrefixedStyle:function(t,r,e){var n=r.charAt(0).toUpperCase()+r.slice(1);this.VENDORS.map(function(r){t.style[r+n]=e,t.style.propName=e})},getPrefixedStyle:function(t,r){var e=r.charAt(0).toUpperCase()+r.slice(1),n=window.getComputedStyle(t);return n[r]||this.VENDORS.reduce(function(t,r){return n[r+e]||t},void 0)},cloneNumArray:function(t){return t.map(function(t){return t instanceof Array?s.cloneNumArray(t):t})},numArraysEqual:function(t,r,e){e=e||0;var n=this;return t&&r&&t.length===r.length&&this.zip(t,r).reduce(function(t,r){var i;return i=r[0]instanceof Array||r[1]instanceof Array?r[0].length===r[1].length&&n.numArraysEqual.apply(n,r.concat(e)):Math.abs(r[0]-r[1])<=e,t&&i},!0)},cloneObject:function(t){return JSON.parse(JSON.stringify(t))},cacheMod:function(t,r,e){var n=s.merge(t,e||{});return r&&r.map(function(t){n[t]=null}),n}};return t.prototype={clone:function(){return new t(s.cloneNumArray(this._matrix),this._cache)},get:function(t,r){return this._matrix[t][r]},set:function(t,r,e){var n=this.clone();return n._cache={},n._matrix[t][r]=e,n},equals:function(r,e){return r instanceof t&&s.numArraysEqual(this._matrix,r._matrix,e)},add:function(r){return new t(s.zip(this._matrix,r._matrix).map(function(t){return s.zip.apply(void 0,t).map(function(t){return t[0]+t[1]})}))},subtract:function(t){return this.add(t.multiply(-1))},multiply:function(r){if("number"==typeof r)return new t(this._matrix.map(function(t){return t.map(function(t){return t*r})}));var e=s.zip.apply(void 0,r._matrix);if(this.cols!==r.rows)throw Error("Can not multiply matrices of incompatible sizes: "+this.rows+"x"+this.cols+" * "+r.rows+"x"+r.cols);return new t(this._matrix.map(function(t){return e.map(function(r){return s.zip(t,r).map(function(t){return t[0]*t[1]}).reduce(function(t,r){return t+r},0)})}))},det:function(){if(this._cache.det)return this._cache.det;if(this.rows!==this.cols)return 0/0;var r,e=this._matrix;return 1===this.rows?e[0][0]:2===this.rows?e[0][0]*e[1][1]-e[0][1]*e[1][0]:(r=e[0].reduce(function(r,n,i){if(0===n)return r;var a=i%2*-2+1,s=new t(e.slice(1).map(function(t){return t.filter(function(t,r){return r!==i})}));return r+a*n*s.det()},0),this._cache.det=r,r)},transpose:function(){return new t(s.zip.apply(void 0,this._matrix))},inv:function(){if(this._cache.inv)return this._cache.inv;if(this.rows!==this.cols)throw Error("Could not invert non-square matrix");var r,e,n=this._matrix,i=0;return e=n.map(function(r,e){return r.map(function(r,a){var o,c,u=s.cloneNumArray(n),h=(e+a)%2*-2+1;return u.splice(e,1),o=u.map(function(t){return t.splice(a,1),t}),c=h*new t(o).det(),0===e&&(i+=r*c),c})}),r=new t(e).transpose().multiply(1/i),this._cache.det=i,this._cache.inv=r,r},submatrix:function(r,e){return new t(this._matrix.slice(r[0],r[1]+1||void 0).map(function(t){return t.slice(e[0],e[1]+1||void 0)}))}},r.prototype=s.extend(t.prototype,{clone:function(){var t=s.cloneNumArray(this._matrix);return new r(t,this._origin,this._elem,this._cache)},multiply:function(e){var n=t.prototype.multiply.call(this,e);return new r(n._matrix,this._origin,this._elem)},translate:function(){var t=s.parseVectorArgs(arguments),r=this.getTranslate();return this.setTranslate(s.zip(r,t).map(function(t){return void 0!==t[1]?t[0]+t[1]:0}))},setTranslate:function(){var t=s.parseVectorArgs(arguments),e=s.cloneNumArray(this._matrix),n=s.cacheMod(this._cache,["det","inv"]);return t.map(function(t,r){e[r][3]=t}),new r(e,this._origin,this._elem,n)},getTranslate:function(){return[this._matrix[0][3],this._matrix[1][3],this._matrix[2][3]]},scale:function(){var t=s.parseVectorArgs(arguments,4,1),e=s.zip(t,this._matrix).map(function(t){return t[1].map(function(r){return r*t[0]})}),n=this.getScale(),i=s.cacheMod(this._cache,["det","inv","polarDecomp"],{scale:s.zip(n,t).map(function(t){return t[0]*t[1]})});return new r(e,this._origin,this._elem,i)},setScale:function(){var e=s.parseVectorArgs(arguments,3,1),n=this.polarDecompose().u,i=s.cacheMod(this._cache,["det","inv","polarDecomp"],{scale:e}),a=new t([[e[0],0,0,0],[0,e[1],0,0],[0,0,e[2],0],[0,0,0,1]]),o=n.multiply(a);return new r(o,this._origin,this._elem,i)},getScale:function(){var t=function(t){return[t._matrix[0][0],t._matrix[1][1],t._matrix[2][2]]};return this._cache.scale||t(s.hasRotate(this)?this.polarDecompose().p:this)},rotate:function(r,e){var n=s.normalizeVector(r),i=-n[0]||0,a=Math.pow(i,2),o=-n[1]||0,c=Math.pow(o,2),u=-n[2]||0,h=Math.pow(u,2),l=1-Math.cos(e),m=Math.sin(e),p=[[1+l*(a-1),u*m+i*o*l,-o*m+i*u*l,0],[-u*m+i*o*l,1+l*(c-1),i*m+o*u*l,0],[o*m+i*u*l,-i*m+o*u*l,1+l*(h-1),0],[0,0,0,1]],f=this.multiply(new t(p));return f._cache=s.cacheMod(this._cache,["det","inv","polarDecomp"]),n?f:this},getRotate:function(){var t=this.polarDecompose().u._matrix,r=t[0][0]+t[1][1]+t[2][2],e=Math.acos((r-1)/2),n=-r/2+1.5,i=[Math.sqrt((t[0][0]-1)/n+1)||0,Math.sqrt((t[1][1]-1)/n+1)||0,Math.sqrt((t[2][2]-1)/n+1)||0],a=Math.asin((t[1][2]-i[1]*i[2]*n)/i[0]),s=Math.asin((t[2][0]-i[0]*i[2]*n)/i[1]),o=Math.asin((t[0][1]-i[0]*i[1]*n)/i[2]),c=-(a||s||o||0),u=c>0?e:(2*Math.PI+c)%(2*Math.PI);return{axis:i,angle:u}},setRotate:function(e,n){var i=this.getTranslate(),a=this.getScale(),s=new t(4,4)._matrix,o=new r(s,this._origin,this._elem).setScale(a).setTranslate(i).rotate(e,n);return o},polarDecompose:function(){if(this._cache.polarDecomp)return this._cache.polarDecomp;var r,e,n,i,a,o=this.submatrix([0,2],[0,2]),c=r,u=function(r){var e=r._matrix.map(function(t){return t.concat(0)});return e.push([0,0,0,1]),new t(e)};if(!s.hasRotate(this))return{u:new t(4,4),p:this};if(this._cache.scale)return a=this.reset().scale(this._cache.scale).submatrix([0,2],[0,2]),{u:u(o.multiply(a.inv())),p:u(a)};for(;!o.equals(r,1e-10);)e=o,c=o.inv(),o=o.add(c.transpose()).multiply(.5),r=e;return n=this.det(),i={u:u(r),p:u(c.multiply(this.submatrix([0,2],[0,2])))},this._cache.polarDecomp=i,i},changeOrigin:function(){var r={width:parseFloat(window.getComputedStyle(this._elem).width),height:parseFloat(window.getComputedStyle(this._elem).height)},e=s.parseOriginArgs(arguments,r),n=s.zip(this._origin,e).map(function(t){return null!==t[1]?t[1]-t[0]:0}),i=this.getScale(),a=this.polarDecompose().u,o=s.zip(n,i).map(function(t){return t[0]*t[1]}),c=new t([o.concat(0)]).transpose().multiply(-1),u=a.multiply(c).transpose()._matrix[0],h=s.zip(n,u).map(function(t){return-(t[0]+t[1])});return this._origin=s.zip(this._origin,e).map(function(t){return null!==t[1]?t[1]:t[0]}),this.translate(h)},setOrigin:function(){var t={width:parseFloat(window.getComputedStyle(this._elem).width),height:parseFloat(window.getComputedStyle(this._elem).height)},e=s.parseOriginArgs(arguments,t);return new r(this._matrix,e,this._elem)},getOrigin:function(){return s.cloneNumArray(this._origin)},toTransformMatrix:function(){var t=s.zip.apply(this,this._matrix).map(function(t){return t.map(function(t){return s.truncate(t,6)}).join(", ")}).join(", ");return"matrix3d("+t+")"},getOriginCSS:function(){return this._origin[0]+"px "+this._origin[1]+"px "+this._origin[2]},apply:function(t){t=t?s.getElem(t):this._elem,s.setPrefixedStyle(t,"transform",this.toTransformMatrix()),s.setPrefixedStyle(t,"transformOrigin",this.getOriginCSS());var r=t.getAttribute("data-sscid");return r||(r=a,t.setAttribute("data-sscid",a),a+=1),i[r]=this._cache,this},reset:function(){return new r(new t(4,4),this._origin,this._elem,{det:1,inv:1,scale:[1,1,1],polarDecomp:void 0})}}),n.Matrix=t,n.CSSMatrix=r,n._utils=s,n});