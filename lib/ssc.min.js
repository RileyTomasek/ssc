!function(t){"use strict";"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():window.ssc=t()}(function(){"use strict";function t(){var e,r,n,i;if(arguments[0]instanceof t)i=arguments[0],this._matrix=i._matrix,this._cache=i._cache;else if(arguments[0]instanceof Array)this._matrix=s.cloneNumArray(arguments[0]),this._cache=arguments[1]||{};else{for(this._matrix=[],e=0;e<arguments[0];e++){for(n=[],r=0;r<arguments[1];r++)n.push(e===r?1:0);this._matrix.push(n)}this._cache=arguments[2]||{}}this.rows=this._matrix.length,this.cols=this._matrix[0].length}function e(e,r,n,a){t.call(this,e),this._origin=r,this._elem=n;var o=n.getAttribute("data-sscid");this._cache=s.cacheMod(i[o]||{},null,a)}function r(t,r){t=s.getElem(t);var n,i,a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],o=s.getPrefixedStyle(t,"transform"),c=s.getPrefixedStyle(t,"transformOrigin");if(i=c.split(" ").map(parseFloat),i[2]=i[2]||0,o&&"none"!==o)if(n=o.substring(o.indexOf("(")+1,o.length-1),n=n.split(", ").map(function(t){return s.truncate(parseFloat(t),2)}),6===n.length)n.map(function(t,e){var r=e%2,n=Math.floor(e/2)+(e>3?1:0);a[r][n]=t});else{if(16!==n.length)throw Error("elem has a transformation matrix that is not well defined");n.map(function(t,e){var r=e%4,n=Math.floor(e/4);a[r][n]=t})}return new e(a,i,t,r)}function n(t,e){return r(t,e)}var i={},a=0,s={getElem:function(t){if(!(t instanceof Element)){if("string"!=typeof t)throw Error("elem must be either an Element or a CSS Selector");if(t=document.querySelector(t),!t)throw Error("elem selector does not refer to a valid Element")}return t},extend:function(t,e){var r,n=Object.create(t);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},merge:function(t,e){var r,n=this.cloneObject(t);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n},truncate:function(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r},padVector:function(t,e,r){var n,i=[];for(e=e||3,r=void 0!==r?r:0,n=0;e>n;n++)i.push(t[n]||0===t[n]?t[n]:r);return i},parseVectorArgs:function(t,e,r){t=Array.prototype.slice.call(t);var n=(t[0]instanceof Array?t[0]:t).slice(0,3);return s.padVector(n,e,r)},parseOriginArgs:function(t,e){var r=[];return"string"==typeof t[0]?t[0].split(" ").map(function(t,n,i){var a;if(-1!==t.indexOf("%"))a=0===n?e.width:e.height,r[n]=a*parseFloat(t)/100;else switch(t.toLowerCase()){case"left":r[0]=0;break;case"right":r[0]=e.width;break;case"top":r[1]=0;break;case"bottom":r[1]=e.height;break;case"center":1===i.length?r=[e.width/2,e.height/2]:0===n?r[0]=e.width/2:r[1]=e.height/2;break;default:r[2]=parseInt(t,10)}}):r=s.parseVectorArgs(t,3,null),r[2]=r[2]||0,r},zip:function(){var t=Array.prototype.slice.call(arguments),e=t.reduce(function(t,e){return t.length<e.length?t:e});return e.map(function(e,r){return t.map(function(t){return t[r]})})},normalizeVector:function(t){var e,r;return e=Math.sqrt(t.reduce(function(t,e){return t+Math.pow(e,2)},0)),r=t.map(function(t){return t/e}),e?r:0},hasRotate:function(t){t=t._matrix;var e=[t[0][0],t[1][1],t[2][2]].reduce(function(t,e){return t&&e>=0},!0);return!(!(t[0][1]||t[1][2]||t[2][0])&&e)},VENDORS:["Moz","Webkit","ms","O"],setPrefixedStyle:function(t,e,r){var n=e.charAt(0).toUpperCase()+e.slice(1);this.VENDORS.map(function(e){t.style[e+n]=r,t.style.propName=r})},getPrefixedStyle:function(t,e){var r=e.charAt(0).toUpperCase()+e.slice(1),n=window.getComputedStyle(t);return n[e]||this.VENDORS.reduce(function(t,e){return n[e+r]||t},void 0)},cloneNumArray:function(t){return t.map(function(t){return t instanceof Array?s.cloneNumArray(t):t})},numArraysEqual:function(t,e,r){r=r||0;var n=this;return t&&e&&t.length===e.length&&this.zip(t,e).reduce(function(t,e){var i;return i=e[0]instanceof Array||e[1]instanceof Array?e[0].length===e[1].length&&n.numArraysEqual.apply(n,e.concat(r)):Math.abs(e[0]-e[1])<=r,t&&i},!0)},cloneObject:function(t){return JSON.parse(JSON.stringify(t))},cacheMod:function(t,e,r){var n=s.merge(t,r||{});return e&&e.map(function(t){n[t]=null}),n}};return t.prototype={clone:function(){return new t(s.cloneNumArray(this._matrix),this._cache)},get:function(t,e){return this._matrix[t][e]},set:function(t,e,r){var n=this.clone();return n._cache={},n._matrix[t][e]=r,n},equals:function(e,r){return e instanceof t&&s.numArraysEqual(this._matrix,e._matrix,r)},add:function(e){return new t(s.zip(this._matrix,e._matrix).map(function(t){return s.zip.apply(void 0,t).map(function(t){return t[0]+t[1]})}))},subtract:function(t){return this.add(t.multiply(-1))},multiply:function(e){if("number"==typeof e)return new t(this._matrix.map(function(t){return t.map(function(t){return t*e})}));var r=s.zip.apply(void 0,e._matrix);if(this.cols!==e.rows)throw Error("Can not multiply matrices of incompatible sizes: "+this.rows+"x"+this.cols+" * "+e.rows+"x"+e.cols);return new t(this._matrix.map(function(t){return r.map(function(e){return s.zip(t,e).map(function(t){return t[0]*t[1]}).reduce(function(t,e){return t+e},0)})}))},det:function(){if(this._cache.det)return this._cache.det;if(this.rows!==this.cols)return 0/0;var e,r=this._matrix;return 1===this.rows?r[0][0]:2===this.rows?r[0][0]*r[1][1]-r[0][1]*r[1][0]:(e=r[0].reduce(function(e,n,i){if(0===n)return e;var a=i%2*-2+1,s=new t(r.slice(1).map(function(t){return t.filter(function(t,e){return e!==i})}));return e+a*n*s.det()},0),this._cache.det=e,e)},transpose:function(){return new t(s.zip.apply(void 0,this._matrix))},inv:function(){if(this._cache.inv)return this._cache.inv;if(this.rows!==this.cols)throw Error("Could not invert non-square matrix");var e,r,n=this._matrix,i=0;return r=n.map(function(e,r){return e.map(function(e,a){var o,c,u=s.cloneNumArray(n),h=(r+a)%2*-2+1;return u.splice(r,1),o=u.map(function(t){return t.splice(a,1),t}),c=h*new t(o).det(),0===r&&(i+=e*c),c})}),e=new t(r).transpose().multiply(1/i),this._cache.det=i,this._cache.inv=e,e},submatrix:function(e,r){return new t(this._matrix.slice(e[0],e[1]+1||void 0).map(function(t){return t.slice(r[0],r[1]+1||void 0)}))}},e.prototype=s.extend(t.prototype,{clone:function(){var t=s.cloneNumArray(this._matrix);return new e(t,this._origin,this._elem,this._cache)},multiply:function(r){var n=t.prototype.multiply.call(this,r);return new e(n._matrix,this._origin,this._elem)},translate:function(){var t=s.parseVectorArgs(arguments),e=this.getTranslate();return this.setTranslate(s.zip(e,t).map(function(t){return void 0!==t[1]?t[0]+t[1]:0}))},setTranslate:function(){var t=s.parseVectorArgs(arguments),r=s.cloneNumArray(this._matrix),n=s.cacheMod(this._cache,["det","inv"]);return t.map(function(t,e){r[e][3]=t}),new e(r,this._origin,this._elem,n)},getTranslate:function(){return[this._matrix[0][3],this._matrix[1][3],this._matrix[2][3]]},scale:function(){var t=s.parseVectorArgs(arguments,4,1),r=s.zip(t,this._matrix).map(function(t){return t[1].map(function(e){return e*t[0]})}),n=this.getScale(),i=s.cacheMod(this._cache,["det","inv","polarDecomp"],{scale:s.zip(n,t).map(function(t){return t[0]*t[1]})});return new e(r,this._origin,this._elem,i)},setScale:function(){var r=s.parseVectorArgs(arguments,3,1),n=this.polarDecompose().u,i=s.cacheMod(this._cache,["det","inv","polarDecomp"],{scale:r}),a=new t([[r[0],0,0,0],[0,r[1],0,0],[0,0,r[2],0],[0,0,0,1]]),o=n.multiply(a);return new e(o,this._origin,this._elem,i)},getScale:function(){var t=function(t){return[t._matrix[0][0],t._matrix[1][1],t._matrix[2][2]]};return this._cache.scale||t(s.hasRotate(this)?this.polarDecompose().p:this)},rotate:function(e,r){var n=s.normalizeVector(e),i=-n[0]||0,a=Math.pow(i,2),o=-n[1]||0,c=Math.pow(o,2),u=-n[2]||0,h=Math.pow(u,2),l=1-Math.cos(r),m=Math.sin(r),p=[[1+l*(a-1),u*m+i*o*l,-o*m+i*u*l,0],[-u*m+i*o*l,1+l*(c-1),i*m+o*u*l,0],[o*m+i*u*l,-i*m+o*u*l,1+l*(h-1),0],[0,0,0,1]],f=this.multiply(new t(p));return f._cache=s.cacheMod(this._cache,["det","inv","polarDecomp"]),n?f:this},getRotate:function(){var t=this.polarDecompose().u._matrix,e=t[0][0]+t[1][1]+t[2][2],r=Math.acos((e-1)/2),n=-e/2+1.5,i=[Math.sqrt((t[0][0]-1)/n+1)||0,Math.sqrt((t[1][1]-1)/n+1)||0,Math.sqrt((t[2][2]-1)/n+1)||0],a=Math.asin((t[1][2]-i[1]*i[2]*n)/i[0]),s=Math.asin((t[2][0]-i[0]*i[2]*n)/i[1]),o=Math.asin((t[0][1]-i[0]*i[1]*n)/i[2]),c=-(a||s||o||0),u=c>0?r:(2*Math.PI+c)%(2*Math.PI);return{axis:i,angle:u}},setRotate:function(r,n){var i=this.getTranslate(),a=this.getScale(),s=new t(4,4)._matrix,o=new e(s,this._origin,this._elem).setScale(a).setTranslate(i).rotate(r,n);return o},polarDecompose:function(){if(this._cache.polarDecomp)return this._cache.polarDecomp;var e,r,n,i,a,o=this.submatrix([0,2],[0,2]),c=e,u=function(e){var r=e._matrix.map(function(t){return t.concat(0)});return r.push([0,0,0,1]),new t(r)};if(!s.hasRotate(this))return{u:new t(4,4),p:this};if(this._cache.scale)return a=this.reset().scale(this._cache.scale).submatrix([0,2],[0,2]),{u:u(o.multiply(a.inv())),p:u(a)};for(;!o.equals(e,1e-10);)r=o,c=o.inv(),o=o.add(c.transpose()).multiply(.5),e=r;return n=this.det(),i={u:u(e),p:u(c.multiply(this.submatrix([0,2],[0,2])))},this._cache.polarDecomp=i,i},changeOrigin:function(){var e={width:parseFloat(window.getComputedStyle(this._elem).width),height:parseFloat(window.getComputedStyle(this._elem).height)},r=s.parseOriginArgs(arguments,e),n=s.zip(this._origin,r).map(function(t){return null!==t[1]?t[1]-t[0]:0}),i=this.getScale(),a=this.polarDecompose().u,o=s.zip(n,i).map(function(t){return t[0]*t[1]}),c=new t([o.concat(0)]).transpose().multiply(-1),u=a.multiply(c).transpose()._matrix[0],h=s.zip(n,u).map(function(t){return-(t[0]+t[1])});return this._origin=s.zip(this._origin,r).map(function(t){return null!==t[1]?t[1]:t[0]}),this.translate(h)},setOrigin:function(){var t={width:parseFloat(window.getComputedStyle(this._elem).width),height:parseFloat(window.getComputedStyle(this._elem).height)},r=s.parseOriginArgs(arguments,t);return new e(this._matrix,r,this._elem)},getOrigin:function(){return s.cloneNumArray(this._origin)},toTransformMatrix:function(){var t=s.zip.apply(this,this._matrix).map(function(t){return t.map(function(t){return s.truncate(t,6)}).join(", ")}).join(", ");return"matrix3d("+t+")"},getOriginCSS:function(){return this._origin[0]+"px "+this._origin[1]+"px "+this._origin[2]},apply:function(t){t=t?s.getElem(t):this._elem,s.setPrefixedStyle(t,"transform",this.toTransformMatrix()),s.setPrefixedStyle(t,"transformOrigin",this.getOriginCSS());var e=t.getAttribute("data-sscid");return e||(e=a,t.setAttribute("data-sscid",a),a+=1),i[e]=this._cache,this},reset:function(){return new e(new t(4,4),this._origin,this._elem,{det:1,inv:1,scale:[1,1,1],polarDecomp:void 0})}}),n.Matrix=t,n.CSSMatrix=e,n._utils=s,n});